from rhino import rhino

atom_property = rhino.Property("ndvi")
atom_property.setSimilarityFunction({"property":"min(ndvi)","value":0.2, "operator": "gt"})
dc = rhino.Datacube(show_progress = True, atom_property=atom_property)

#dc.load(product = "s2a_sen2cor_granule_ingested_10", domain = {"geometry": "POLYGON((676388 2453906, 680313 2453906, 680313 2459794, 680313 2459794, 676388 2453906))", "crs":'EPSG:32635'})

wkt_geometry = wkt_polygon = """Polygon ((676807.47897574095986784 2453946.54447439312934875, 678498.89029649586882442 2454515.2086253366433084, 678630.1204851750517264 2454806.83126684604212642, 678440.56576819391921163 2455433.81994609115645289, 679315.433692722232081 2455798.34824797790497541, 678673.86388140148483217 2457737.63881401577964425, 678425.9846361184027046 2458014.68032344989478588, 678003.13180592970456928 2459356.14447439322248101, 674926.51293800503481179 2458335.46522911032661796, 675305.62237196729984134 2456789.8652291102334857, 675582.66388140129856765 2456571.14824797818437219, 675888.8676549862138927 2456614.89164420450106263, 676807.47897574095986784 2453946.54447439312934875))"""
dc.load(product = "s2a_sen2cor_granule_ingested_10", domain = {"geometry": wkt_geometry, "crs":'EPSG:32635'})


objects, coverage, level = dc.execute("aggregation", parameters = None, level = 0)

objects[0].getAttributeValue("avg(ndvi)")


